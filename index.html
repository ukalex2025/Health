<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wellness Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --bg-color: #121212;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-color: #e0e0e0;
            --accent-color: #4a90e2;
            --input-bg: rgba(255, 255, 255, 0.02);
            --input-border: rgba(255, 255, 255, 0.08);
            --blur: blur(10px);
            --shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            --dropdown-bg: #1e1e1e;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: var(--glass-bg);
            backdrop-filter: var(--blur);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        h1 {
            text-align: center;
            margin-bottom: 24px;
            font-size: 24px;
            font-weight: 500;
        }

        h2 {
            font-size: 18px;
            margin-bottom: 16px;
            color: var(--accent-color);
        }

        section {
            margin-bottom: 24px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 14px;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--accent-color);
            outline: none;
        }

        select {
            appearance: none;
        }

        select option {
            background-color: var(--dropdown-bg);
            color: var(--text-color);
        }

        .quick-add {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .quick-add button {
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 20px;
            padding: 6px 12px;
            color: var(--text-color);
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        .quick-add button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 24px;
        }

        button {
            padding: 12px 24px;
            background: var(--accent-color);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        button:hover {
            opacity: 0.9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 24px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--input-border);
            font-size: 14px;
        }

        th {
            font-weight: 500;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            font-size: 14px;
            margin-bottom: 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }

        .image-upload-section {
            background: rgba(255, 255, 255, 0.02);
            border: 1px dashed var(--input-border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .image-upload-section h3 {
            margin: 0 0 12px 0;
            font-size: 16px;
            color: var(--accent-color);
        }

        .image-preview {
            margin-top: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .image-preview img {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            border: 1px solid var(--input-border);
        }

        .image-item {
            position: relative;
            display: inline-block;
        }

        .remove-image {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
        }

        .file-input {
            margin-bottom: 8px;
        }

        .pdf-options {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .pdf-options h3 {
            margin: 0 0 12px 0;
            font-size: 16px;
            color: var(--accent-color);
        }

        .date-range {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 12px;
        }

        .date-range input {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Wellness Tracker</h1>

        <section>
            <h2>Daily Details</h2>
            <label>Date <input type="date" id="date"></label>
            <label>Tag
                <select id="tag">
                    <option>(none)</option>
                    <option>Workday</option>
                    <option>Weekend</option>
                    <option>Rest day</option>
                    <option>Travel</option>
                    <option>Family</option>
                    <option>Date</option>
                    <option>Solo</option>
                    <option>Project day</option>
                    <option>Sick day</option>
                </select>
            </label>
            <label>Protocol
                <select id="protocol">
                    <option>On Plan</option>
                    <option>Flexible</option>
                    <option>Deviation</option>
                    <option>Random Binge</option>
                    <option>Sick Day</option>
                    <option>Reset</option>
                </select>
            </label>
        </section>

        <section>
            <h2>Screenshots & Images</h2>
            
            <div class="image-upload-section">
                <h3>Sleep Data Screenshots</h3>
                <input type="file" accept="image/*" multiple class="file-input" id="sleep-images" onchange="handleImageUpload('sleep-images', 'sleep-preview')">
                <div class="image-preview" id="sleep-preview"></div>
            </div>

            <div class="image-upload-section">
                <h3>Heart Rate Screenshots</h3>
                <input type="file" accept="image/*" multiple class="file-input" id="heart-images" onchange="handleImageUpload('heart-images', 'heart-preview')">
                <div class="image-preview" id="heart-preview"></div>
            </div>

            <div class="image-upload-section">
                <h3>Exercise Screenshots</h3>
                <input type="file" accept="image/*" multiple class="file-input" id="exercise-images" onchange="handleImageUpload('exercise-images', 'exercise-preview')">
                <div class="image-preview" id="exercise-preview"></div>
            </div>

            <div class="image-upload-section">
                <h3>Other Screenshots</h3>
                <input type="file" accept="image/*" multiple class="file-input" id="other-images" onchange="handleImageUpload('other-images', 'other-preview')">
                <div class="image-preview" id="other-preview"></div>
            </div>
        </section>

        <section>
            <h2>Sleep</h2>
            <label>Hours Slept <input type="number" step="0.1" id="sleep-hours"></label>
            <label>Sleep Quality
                <select id="sleep-quality">
                    <option>Select...</option>
                    <option>Very Poor</option>
                    <option>Poor</option>
                    <option>Fair</option>
                    <option>Good</option>
                    <option>Excellent</option>
                </select>
            </label>
            <label>Sleep Notes <textarea id="sleep-notes"></textarea></label>
        </section>

        <section>
            <h2>Body Metrics</h2>
            <label>Weight (kg) <input type="number" step="0.1" id="weight"></label>
            <label>Body Fat % (est) <input type="number" step="0.1" id="body-fat"></label>
            <label>Resting HR <input type="number" id="resting-hr"></label>
        </section>

        <section>
            <h2>Nutrition</h2>
            <label>Add to Meal
                <select id="add-to-meal">
                    <option>Breakfast</option>
                    <option>Morning Snack</option>
                    <option>Lunch</option>
                    <option>Dinner</option>
                    <option>Evening Snack</option>
                    <option>Other Foods</option>
                </select>
            </label>
            <div>Quick-Add Foods</div>
            <div class="quick-add">
                <button onclick="addFood('Chicken')">Chicken</button>
                <button onclick="addFood('Steak')">Steak</button>
                <button onclick="addFood('Eggs')">Eggs</button>
                <button onclick="addFood('Greek Yogurt')">Greek Yogurt</button>
                <button onclick="addFood('Avocado')">Avocado</button>
                <button onclick="addFood('Seeds')">Seeds</button>
                <button onclick="addFood('Spinach')">Spinach</button>
                <button onclick="addFood('Salad')">Salad</button>
                <button onclick="addFood('Berries')">Berries</button>
                <button onclick="addFood('Tzatziki')">Tzatziki</button>
                <button onclick="addFood('Nuts')">Nuts</button>
                <button onclick="addFood('Air-Fried Bacon')">Air-Fried Bacon</button>
                <button onclick="addFood('Maize-Free Wrap')">Maize-Free Wrap</button>
                <button onclick="addFood('Turkey mince')">Turkey mince</button>
                <button onclick="addFood('Basmati rice')">Basmati rice</button>
                <button onclick="addFood('Sweet potato')">Sweet potato</button>
            </div>
            <label>Breakfast (comma-separated) <input type="text" id="breakfast" list="food-suggestions"></label>
            <label>Morning Snack (comma-separated) <input type="text" id="morning-snack" list="food-suggestions"></label>
            <label>Lunch (comma-separated) <input type="text" id="lunch" list="food-suggestions"></label>
            <label>Dinner (comma-separated) <input type="text" id="dinner" list="food-suggestions"></label>
            <label>Evening Snack (comma-separated) <input type="text" id="evening-snack" list="food-suggestions"></label>
            <label>Other Foods (comma-separated) <input type="text" id="other-foods" list="food-suggestions"></label>
            <datalist id="food-suggestions">
                <option value="Chicken"></option>
                <option value="Steak"></option>
                <option value="Eggs"></option>
                <option value="Greek Yogurt"></option>
                <option value="Avocado"></option>
                <option value="Seeds"></option>
                <option value="Spinach"></option>
                <option value="Salad"></option>
                <option value="Berries"></option>
                <option value="Tzatziki"></option>
                <option value="Nuts"></option>
                <option value="Air-Fried Bacon"></option>
                <option value="Maize-Free Wrap"></option>
                <option value="Turkey mince"></option>
                <option value="Basmati rice"></option>
                <option value="Sweet potato"></option>
            </datalist>
            <label>Water (L) <input type="number" step="0.1" id="water"></label>
            <label>Portion control
                <select id="portion-control">
                    <option>-</option>
                    <option>Less than planned</option>
                    <option>On plan</option>
                    <option>More than planned</option>
                </select>
            </label>
            <label>Gut status
                <select id="gut-status">
                    <option>-</option>
                    <option>Perfect</option>
                    <option>Bloating</option>
                    <option>Gassy</option>
                    <option>Disturbed</option>
                </select>
            </label>
        </section>

        <section>
            <h2>Supplements</h2>
            <div>Quick Add Stack</div>
            <div class="checkbox-group" id="supplements-group">
                <label><input type="checkbox" value="Multivitamin"> Multivitamin</label>
                <label><input type="checkbox" value="Omega-3"> Omega-3</label>
                <label><input type="checkbox" value="Creatine"> Creatine</label>
                <label><input type="checkbox" value="Magnesium Glycinate"> Magnesium Glycinate</label>
                <label><input type="checkbox" value="Vitamin B12"> Vitamin B12</label>
                <label><input type="checkbox" value="L-Methylfolate"> L-Methylfolate</label>
                <label><input type="checkbox" value="Vitamin D3"> Vitamin D3</label>
                <label><input type="checkbox" value="L-Theanine"> L-Theanine</label>
                <label><input type="checkbox" value="L-Glycine"> L-Glycine</label>
                <label><input type="checkbox" value="ACV"> ACV</label>
                <label><input type="checkbox" value="Ginger+Lemon Drink"> Ginger+Lemon Drink</label>
                <label><input type="checkbox" value="Kefir"> Kefir</label>
            </div>
            <label>Other Supplements <input type="text" id="other-supplements"></label>
        </section>

        <section>
            <h2>Training & Activity</h2>
            <label>Type
                <select id="training-type">
                    <option>Press-ups</option>
                    <option>Dog walk</option>
                    <option>Run</option>
                    <option>Gym</option>
                    <option>Calisthenics</option>
                    <option>Active Recovery</option>
                    <option>None</option>
                </select>
            </label>
            <label>Duration (min) <input type="number" id="duration"></label>
            <label>Steps <input type="number" id="steps"></label>
            <label>Intensity
                <select id="intensity">
                    <option>-</option>
                    <option>Low</option>
                    <option>Medium</option>
                    <option>High</option>
                </select>
            </label>
            <label>Quality
                <select id="quality">
                    <option>-</option>
                    <option>Poor</option>
                    <option>Decent</option>
                    <option>Strong</option>
                    <option>Peak</option>
                </select>
            </label>
        </section>

        <section>
            <h2>Mental Health & Wellbeing</h2>
            <label>Mood (1-10) <input type="number" min="1" max="10" id="mood"></label>
            <label>Stress (1-10) <input type="number" min="1" max="10" id="stress"></label>
            <label>Mental Health
                <select id="mental-health">
                    <option>-</option>
                    <option>Stable</option>
                    <option>Anxious</option>
                    <option>Flat</option>
                    <option>Down</option>
                    <option>Motivated</option>
                    <option>Resilient</option>
                </select>
            </label>
            <div>Mood Triggers</div>
            <div class="checkbox-group" id="mood-triggers">
                <label><input type="checkbox" value="Work stress"> Work stress</label>
                <label><input type="checkbox" value="Slept badly"> Slept badly</label>
                <label><input type="checkbox" value="Felt strong"> Felt strong</label>
                <label><input type="checkbox" value="Social win"> Social win</label>
                <label><input type="checkbox" value="Lonely"> Lonely</label>
                <label><input type="checkbox" value="Great food"> Great food</label>
                <label><input type="checkbox" value="Dog walk"> Dog walk</label>
                <label><input type="checkbox" value="Weather"> Weather</label>
                <label><input type="checkbox" value="None"> None</label>
            </div>
            <label>Memory / Focus Notes <textarea id="memory-notes"></textarea></label>
            <label>Gratitude <textarea id="gratitude"></textarea></label>
            <label>Journaling / Notes <textarea id="journal-notes"></textarea></label>
            <label>Time Outdoors (min) <input type="number" id="outdoors"></label>
            <label>Cold Exposure (min) <input type="number" id="cold-exposure"></label>
            <label>Dog Walk (min) <input type="number" id="dog-walk"></label>
        </section>

        <section>
            <h2>Alcohol, Weed, Extras</h2>
            <label>Alcohol (units) <input type="number" id="alcohol"></label>
            <label>Weed (joints) <input type="number" id="weed-joints"></label>
            <label>Weed (bongs) <input type="number" id="weed-bongs"></label>
        </section>

        <div class="buttons">
            <button onclick="copyLastEntry()">Copy Last Entry</button>
            <button onclick="addEntry()">Add Entry</button>
            <button onclick="exportJSON()">Export JSON</button>
        </div>
    </div>

    <div class="container">
        <h2>PDF Export Options</h2>
        <div class="pdf-options">
            <h3>Generate Comprehensive PDF Report</h3>
            <div class="date-range">
                <label>From: <input type="date" id="pdf-date-from"></label>
                <label>To: <input type="date" id="pdf-date-to"></label>
            </div>
            <div class="checkbox-group">
                <label><input type="checkbox" id="include-data" checked> Include Data Summary</label>
                <label><input type="checkbox" id="include-images" checked> Include Screenshots</label>
                <label><input type="checkbox" id="include-raw-data"> Include Raw JSON Data</label>
            </div>
            <button onclick="generatePDF()">Generate PDF Report</button>
        </div>
    </div>

    <div class="container">
        <h2>Entries</h2>
        <table id="entries-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Summary</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        let entries = [];
        let imageStore = {
            sleep: [],
            heart: [],
            exercise: [],
            other: []
        };

        // Load data from localStorage
        function loadData() {
            try {
                const savedEntries = localStorage.getItem('wellness-entries');
                const savedImages = localStorage.getItem('wellness-images');
                
                if (savedEntries) {
                    entries = JSON.parse(savedEntries);
                }
                
                if (savedImages) {
                    imageStore = JSON.parse(savedImages);
                }
                
                console.log('Loaded data:', { entries: entries.length, images: Object.keys(imageStore) });
            } catch (error) {
                console.error('Error loading data:', error);
                entries = [];
                imageStore = { sleep: [], heart: [], exercise: [], other: [] };
            }
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('wellness-entries', JSON.stringify(entries));
                localStorage.setItem('wellness-images', JSON.stringify(imageStore));
                console.log('Data saved successfully');
            } catch (error) {
                console.error('Error saving data:', error);
                alert('Error saving data. Storage might be full.');
            }
        }

        function addFood(food) {
            const meal = document.getElementById('add-to-meal').value.toLowerCase().replace(/\s+/g, '-');
            const input = document.getElementById(meal);
            if (input) {
                input.value = (input.value ? input.value + ', ' + food : food);
            } else {
                console.error('No input found for ' + meal);
            }
        }

        function getSelectedCheckboxes(groupId) {
            const checkboxes = document.querySelectorAll(`#${groupId} input:checked`);
            return Array.from(checkboxes).map(cb => cb.value).join(', ');
        }

        function handleImageUpload(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            const category = inputId.replace('-images', '');
            
            Array.from(input.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = e.target.result;
                    const imageId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    
                    // Store image data
                    imageStore[category].push({
                        id: imageId,
                        data: imageData,
                        name: file.name,
                        date: document.getElementById('date').value || new Date().toISOString().split('T')[0]
                    });
                    
                    // Create preview
                    const imageItem = document.createElement('div');
                    imageItem.className = 'image-item';
                    imageItem.innerHTML = `
                        <img src="${imageData}" alt="${file.name}">
                        <button class="remove-image" onclick="removeImage('${category}', '${imageId}', this.parentElement)">×</button>
                    `;
                    preview.appendChild(imageItem);
                    
                    // Save data after upload
                    saveData();
                };
                reader.readAsDataURL(file);
            });
            
            // Clear input
            input.value = '';
        }

        function removeImage(category, imageId, element) {
            imageStore[category] = imageStore[category].filter(img => img.id !== imageId);
            element.remove();
            // Save data after removal
            saveData();
        }

        function addEntry(isFromExport = false) {
            const entry = {
                date: document.getElementById('date').value,
                tag: document.getElementById('tag').value,
                protocol: document.getElementById('protocol').value,
                sleepHours: document.getElementById('sleep-hours').value,
                sleepQuality: document.getElementById('sleep-quality').value,
                sleepNotes: document.getElementById('sleep-notes').value,
                weight: document.getElementById('weight').value,
                bodyFat: document.getElementById('body-fat').value,
                restingHr: document.getElementById('resting-hr').value,
                breakfast: document.getElementById('breakfast').value,
                morningSnack: document.getElementById('morning-snack').value,
                lunch: document.getElementById('lunch').value,
                dinner: document.getElementById('dinner').value,
                eveningSnack: document.getElementById('evening-snack').value,
                otherFoods: document.getElementById('other-foods').value,
                water: document.getElementById('water').value,
                portionControl: document.getElementById('portion-control').value,
                gutStatus: document.getElementById('gut-status').value,
                supplements: getSelectedCheckboxes('supplements-group'),
                otherSupplements: document.getElementById('other-supplements').value,
                trainingType: document.getElementById('training-type').value,
                duration: document.getElementById('duration').value,
                steps: document.getElementById('steps').value,
                intensity: document.getElementById('intensity').value,
                quality: document.getElementById('quality').value,
                mood: document.getElementById('mood').value,
                stress: document.getElementById('stress').value,
                mentalHealth: document.getElementById('mental-health').value,
                moodTriggers: getSelectedCheckboxes('mood-triggers'),
                memoryNotes: document.getElementById('memory-notes').value,
                gratitude: document.getElementById('gratitude').value,
                journalNotes: document.getElementById('journal-notes').value,
                outdoors: document.getElementById('outdoors').value,
                coldExposure: document.getElementById('cold-exposure').value,
                dogWalk: document.getElementById('dog-walk').value,
                alcohol: document.getElementById('alcohol').value,
                weedJoints: document.getElementById('weed-joints').value,
                weedBongs: document.getElementById('weed-bongs').value,
                images: {
                    sleep: imageStore.sleep.filter(img => img.date === entry.date),
                    heart: imageStore.heart.filter(img => img.date === entry.date),
                    exercise: imageStore.exercise.filter(img => img.date === entry.date),
                    other: imageStore.other.filter(img => img.date === entry.date)
                }
            };

            if (!entry.date) {
                if (!isFromExport) alert('Please select a date before adding.');
                return;
            }

            const existingIndex = entries.findIndex(e => e.date === entry.date);
            if (existingIndex !== -1) {
                entries[existingIndex] = entry;
            } else {
                entries.push(entry);
            }

            // Save data after adding entry
            saveData();
            renderEntries();
            if (!isFromExport) clearForm();
        }

        function copyLastEntry() {
            if (entries.length === 0) return;
            const last = entries[entries.length - 1];
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            document.getElementById('tag').value = last.tag;
            document.getElementById('protocol').value = last.protocol;
            document.getElementById('sleep-hours').value = last.sleepHours;
            document.getElementById('sleep-quality').value = last.sleepQuality;
            document.getElementById('sleep-notes').value = last.sleepNotes;
            document.getElementById('weight').value = last.weight;
            document.getElementById('body-fat').value = last.bodyFat;
            document.getElementById('resting-hr').value = last.restingHr;
            document.getElementById('breakfast').value = last.breakfast;
            document.getElementById('morning-snack').value = last.morningSnack;
            document.getElementById('lunch').value = last.lunch;
            document.getElementById('dinner').value = last.dinner;
            document.getElementById('evening-snack').value = last.eveningSnack;
            document.getElementById('other-foods').value = last.otherFoods;
            document.getElementById('water').value = last.water;
            document.getElementById('portion-control').value = last.portionControl;
            document.getElementById('gut-status').value = last.gutStatus;
            setCheckboxes('supplements-group', last.supplements.split(', '));
            document.getElementById('other-supplements').value = last.otherSupplements;
            document.getElementById('training-type').value = last.trainingType;
            document.getElementById('duration').value = last.duration;
            document.getElementById('steps').value = last.steps;
            document.getElementById('intensity').value = last.intensity;
            document.getElementById('quality').value = last.quality;
            document.getElementById('mood').value = last.mood;
            document.getElementById('stress').value = last.stress;
            document.getElementById('mental-health').value = last.mentalHealth;
            setCheckboxes('mood-triggers', last.moodTriggers.split(', '));
            document.getElementById('memory-notes').value = last.memoryNotes;
            document.getElementById('gratitude').value = last.gratitude;
            document.getElementById('journal-notes').value = last.journalNotes;
            document.getElementById('outdoors').value = last.outdoors;
            document.getElementById('cold-exposure').value = last.coldExposure;
            document.getElementById('dog-walk').value = last.dogWalk;
            document.getElementById('alcohol').value = last.alcohol;
            document.getElementById('weed-joints').value = last.weedJoints;
            document.getElementById('weed-bongs').value = last.weedBongs;
        }

        function setCheckboxes(groupId, values) {
            const checkboxes = document.querySelectorAll(`#${groupId} input[type="checkbox"]`);
            checkboxes.forEach(cb => {
                cb.checked = values.includes(cb.value);
            });
        }

        function clearForm() {
            const formElements = document.querySelectorAll('input:not([type="date"]), select, textarea');
            formElements.forEach(el => {
                if (el.type === 'checkbox') el.checked = false;
                else el.value = '';
            });
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            
            // Clear image previews
            ['sleep-preview', 'heart-preview', 'exercise-preview', 'other-preview'].forEach(previewId => {
                document.getElementById(previewId).innerHTML = '';
            });
            
            // Clear image store for current date
            Object.keys(imageStore).forEach(category => {
                imageStore[category] = imageStore[category].filter(img => img.date !== document.getElementById('date').value);
            });
        }

        function renderEntries() {
            const tbody = document.querySelector('#entries-table tbody');
            tbody.innerHTML = '';
            
            entries.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(entry => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${entry.date}</td>
                    <td>
                        <div>🏷️ ${entry.tag} | 📋 ${entry.protocol}</div>
                        <div>😴 ${entry.sleepHours}h (${entry.sleepQuality}) | 🏃 ${entry.trainingType}</div>
                        <div>📊 Images: Sleep(${entry.images.sleep.length}) HR(${entry.images.heart.length}) Exercise(${entry.images.exercise.length}) Other(${entry.images.other.length})</div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function exportJSON() {
            const dataStr = JSON.stringify({ entries, images: imageStore }, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `wellness-data-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Get date range
            const fromDate = document.getElementById('pdf-date-from').value;
            const toDate = document.getElementById('pdf-date-to').value;
            const includeData = document.getElementById('include-data').checked;
            const includeImages = document.getElementById('include-images').checked;
            const includeRawData = document.getElementById('include-raw-data').checked;
            
            // Filter entries by date range
            let filteredEntries = entries;
            if (fromDate || toDate) {
                filteredEntries = entries.filter(entry => {
                    const entryDate = new Date(entry.date);
                    const from = fromDate ? new Date(fromDate) : new Date('1900-01-01');
                    const to = toDate ? new Date(toDate) : new Date('2100-12-31');
                    return entryDate >= from && entryDate <= to;
                });
            }
            
            let yPosition = 20;
            const pageHeight = doc.internal.pageSize.height;
            const margin = 20;
            
            // Title
            doc.setFontSize(20);
            doc.text('Wellness Tracker Report', margin, yPosition);
            yPosition += 15;
            
            // Date range
            doc.setFontSize(12);
            const dateRange = `${fromDate || 'All'} to ${toDate || 'Current'}`;
            doc.text(`Date Range: ${dateRange}`, margin, yPosition);
            yPosition += 10;
            
            doc.text(`Generated: ${new Date().toLocaleDateString()}`, margin, yPosition);
            yPosition += 20;
            
            // Process each entry
            filteredEntries.forEach((entry, index) => {
                // Check if we need a new page
                if (yPosition > pageHeight - 100) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                // Entry header
                doc.setFontSize(14);
                doc.text(`Entry ${index + 1}: ${entry.date}`, margin, yPosition);
                yPosition += 10;
                
                if (includeData) {
                    doc.setFontSize(10);
                    
                    // Basic info
                    doc.text(`Tag: ${entry.tag} | Protocol: ${entry.protocol}`, margin, yPosition);
                    yPosition += 8;
                    
                    // Sleep
                    doc.text(`Sleep: ${entry.sleepHours}h (${entry.sleepQuality})`, margin, yPosition);
                    yPosition += 8;
                    
                    // Training
                    doc.text(`Training: ${entry.trainingType} (${entry.duration}min, ${entry.intensity} intensity)`, margin, yPosition);
                    yPosition += 8;
                    
                    // Body metrics
                    doc.text(`Weight: ${entry.weight}kg | Body Fat: ${entry.bodyFat}% | Resting HR: ${entry.restingHr}`, margin, yPosition);
                    yPosition += 8;
                    
                    // Mental health
                    doc.text(`Mood: ${entry.mood}/10 | Stress: ${entry.stress}/10 | Mental Health: ${entry.mentalHealth}`, margin, yPosition);
                    yPosition += 15;
                }
                
                // Add images if enabled
                if (includeImages) {
                    const allImages = [
                        ...entry.images.sleep.map(img => ({...img, category: 'Sleep'})),
                        ...entry.images.heart.map(img => ({...img, category: 'Heart Rate'})),
                        ...entry.images.exercise.map(img => ({...img, category: 'Exercise'})),
                        ...entry.images.other.map(img => ({...img, category: 'Other'}))
                    ];
                    
                    if (allImages.length > 0) {
                        doc.setFontSize(12);
                        doc.text('Screenshots:', margin, yPosition);
                        yPosition += 10;
                        
                        allImages.forEach((image, imgIndex) => {
                            try {
                                // Check if we need a new page for the image
                                if (yPosition > pageHeight - 150) {
                                    doc.addPage();
                                    yPosition = 20;
                                }
                                
                                doc.setFontSize(10);
                                doc.text(`${image.category}: ${image.name}`, margin, yPosition);
                                yPosition += 8;
                                
                                // Add image to PDF
                                const imgWidth = 120;
                                const imgHeight = 90;
                                doc.addImage(image.data, 'JPEG', margin, yPosition, imgWidth, imgHeight);
                                yPosition += imgHeight + 10;
                                
                            } catch (error) {
                                console.error('Error adding image to PDF:', error);
                                doc.text(`Error loading image: ${image.name}`, margin, yPosition);
                                yPosition += 8;
                            }
                        });
                        
                        yPosition += 10;
                    }
                }
                
                yPosition += 10;
            });
            
            // Add raw data if requested
            if (includeRawData) {
                doc.addPage();
                doc.setFontSize(14);
                doc.text('Raw JSON Data', margin, 20);
                doc.setFontSize(8);
                
                const jsonData = JSON.stringify(filteredEntries, null, 2);
                const lines = doc.splitTextToSize(jsonData, 170);
                doc.text(lines, margin, 40);
            }
            
            // Save PDF
            const fileName = `wellness-report-${fromDate || 'all'}-to-${toDate || 'current'}-${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
        }

        // Initialize
        document.getElementById('date').value = new Date().toISOString().split('T')[0];
        document.getElementById('pdf-date-from').value = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]; // 30 days ago
        document.getElementById('pdf-date-to').value = new Date().toISOString().split('T')[0];
        
        loadData();
        renderEntries();
    </script>
</body>
</html>
